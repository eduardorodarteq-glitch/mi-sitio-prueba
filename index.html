<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Code Sentinel — Prompt Factory</title>
  <meta name="description" content="Micro-app interna: brief con opciones → prompt maestro automático para web, apps y backend." />

  <!-- Open Graph (SEO básico para la micro-app en sí) -->
  <meta property="og:title" content="AI Code Sentinel — Prompt Factory" />
  <meta property="og:description" content="Genera briefs y prompts maestros con módulos e integraciones activables." />
  <meta property="og:type" content="website" />

  <style>
    :root{
      --bg:#070816;
      --panel:rgba(255,255,255,.06);
      --panel2:rgba(255,255,255,.10);
      --line:rgba(255,255,255,.14);
      --text:rgba(255,255,255,.90);
      --muted:rgba(255,255,255,.62);
      --a:#7cf7ff;
      --b:#b37cff;
      --ok:#2bff88;
      --bad:#ff4d6d;
      --shadow: 0 18px 70px rgba(0,0,0,.45);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 15% 12%, rgba(124,247,255,.18), transparent 60%),
        radial-gradient(900px 650px at 85% 20%, rgba(179,124,255,.18), transparent 55%),
        linear-gradient(180deg, #050611, var(--bg) 40%, #050611);
      overflow-x:hidden;
    }
    .container{max-width:1150px; margin:0 auto; padding:16px;}
    .top{
      position:sticky; top:0; z-index:10;
      background: rgba(5,6,17,.55);
      backdrop-filter: blur(12px);
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .topbar{display:flex; justify-content:space-between; align-items:center; gap:12px; padding:12px 0;}
    .brand{display:flex; align-items:center; gap:10px; min-width:0;}
    .logo{
      width:38px; height:38px; border-radius:12px;
      background: radial-gradient(circle at 30% 30%, rgba(124,247,255,.9), rgba(179,124,255,.8));
      box-shadow: 0 0 0 1px rgba(255,255,255,.18), 0 18px 45px rgba(124,247,255,.12);
      position:relative; overflow:hidden;
    }
    .logo:before{
      content:""; position:absolute; inset:-50%;
      background: conic-gradient(from 180deg, rgba(255,255,255,0), rgba(255,255,255,.30), rgba(255,255,255,0));
      animation: spin 6s linear infinite;
      opacity:.8;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    h1{margin:0; font-size:14px; letter-spacing:.14em; text-transform:uppercase; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
    .sub{margin:4px 0 0; color:var(--muted); font-size:12px; line-height:1.35; max-width:75ch;}
    .pill{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.25);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    }
    .pill b{color:rgba(255,255,255,.88)}
    .grid{display:grid; grid-template-columns: 1fr 1fr; gap:12px; align-items:start;}
    @media (max-width: 980px){ .grid{grid-template-columns:1fr;} }

    .card{
      background: linear-gradient(180deg, var(--panel), rgba(255,255,255,.04));
      border:1px solid var(--line);
      border-radius:var(--r);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
    }
    .head{
      padding:14px;
      border-bottom:1px solid rgba(255,255,255,.08);
      display:flex; justify-content:space-between; align-items:flex-start; gap:10px;
    }
    .head b{letter-spacing:.02em;}
    .head small{display:block; margin-top:4px; color:var(--muted); font-size:12px; line-height:1.35;}
    .body{padding:14px;}
    label{display:block; font-size:12px; color:var(--muted); margin:0 0 6px;}
    input, select, textarea{
      width:100%;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      color:var(--text);
      border-radius:14px;
      padding:10px 12px;
      outline:none;
      font-size:13px;
    }
    textarea{min-height:80px; resize:vertical;}
    input:focus, select:focus, textarea:focus{
      border-color: rgba(124,247,255,.55);
      box-shadow: 0 0 0 3px rgba(124,247,255,.12);
    }
    .row{display:grid; grid-template-columns: 1fr 1fr; gap:10px;}
    @media (max-width: 980px){ .row{grid-template-columns:1fr;} }

    .checks{display:grid; grid-template-columns: 1fr 1fr; gap:8px;}
    @media (max-width: 980px){ .checks{grid-template-columns:1fr;} }
    .ck{
      display:flex; gap:10px; align-items:flex-start;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      border-radius:14px;
      padding:10px;
    }
    .ck input{width:auto; margin-top:2px;}
    .ck b{display:block; font-size:12px;}
    .ck small{display:block; color:var(--muted); font-size:11px; margin-top:3px; line-height:1.35;}

    .actions{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    .btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color:var(--text);
      border-radius:14px;
      padding:10px 12px;
      font-weight:900;
      font-size:12px;
      cursor:pointer;
      transition: transform .12s ease, background .2s ease, border .2s ease;
    }
    .btn:hover{transform: translateY(-1px); background: rgba(255,255,255,.12); border-color: rgba(255,255,255,.26);}
    .btn.primary{
      border-color: rgba(124,247,255,.45);
      background: linear-gradient(180deg, rgba(124,247,255,.22), rgba(179,124,255,.18));
    }
    .btn.danger{border-color: rgba(255,77,109,.30);}
    .btn.danger:hover{background: rgba(255,77,109,.10);}

    .out{
      width:100%;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      color: rgba(255,255,255,.86);
      border-radius:14px;
      padding:12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono";
      font-size:12px;
      line-height:1.5;
      min-height: 180px;
      white-space:pre-wrap;
      word-break:break-word;
    }
    .hint{color:var(--muted); font-size:12px; line-height:1.45;}
    .tag{display:inline-flex; gap:8px; align-items:center; border:1px solid rgba(255,255,255,.16); background: rgba(0,0,0,.22); padding:6px 10px; border-radius:999px; font-size:12px; color:var(--muted);}
    .dot{width:10px; height:10px; border-radius:50%; background: var(--ok); box-shadow:0 0 18px rgba(43,255,136,.25);}
    .toast{
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
      z-index:99; opacity:0; transition: opacity .2s ease, transform .2s ease;
      background: rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.16);
      border-radius:999px;
      padding:10px 14px;
      color: rgba(255,255,255,.9);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      font-size:12px;
      pointer-events:none;
    }
    .toast.on{opacity:1; transform:translateX(-50%) translateY(-6px);}
    footer{padding:18px 0 70px; color:var(--muted); font-size:12px;}
    .footRow{display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap; align-items:center;}
    .footRow a{color: rgba(255,255,255,.78); text-decoration:none;}
    .footRow a:hover{text-decoration:underline;}

    /* Modal legal */
    .modalWrap{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      z-index:80;
      padding:16px;
    }
    .modalWrap.on{display:flex; align-items:center; justify-content:center;}
    .modal{
      width:min(920px, 100%);
      max-height: 88vh;
      overflow:auto;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(5,6,17,.86);
      backdrop-filter: blur(14px);
      box-shadow: var(--shadow);
    }
    .modalHead{
      padding:14px;
      border-bottom:1px solid rgba(255,255,255,.10);
      display:flex; justify-content:space-between; align-items:center; gap:10px;
    }
    .modalHead b{letter-spacing:.02em;}
    .modalBody{padding:14px; color: rgba(255,255,255,.78); font-size:13px; line-height:1.65;}
    .modalBody h3{margin:14px 0 8px; color: rgba(255,255,255,.92);}
    .modalBody ul{margin:8px 0 0 18px;}
  </style>
</head>

<body>
  <div class="top">
    <div class="container topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div style="min-width:0">
          <h1>AI Code Sentinel — Prompt Factory</h1>
          <p class="sub">Para ti: genera BRIEF + PROMPT MAESTRO para web, apps, backend y full-stack. Incluye módulos activables + SEO + legal.</p>
        </div>
      </div>
      <div class="pill">
        <span>v1.3</span>
        <span>·</span>
        <span><b>personal</b></span>
        <span>·</span>
        <span>presets ✅</span>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="grid">
      <!-- LEFT: FORM -->
      <div class="card">
        <div class="head">
          <div>
            <b>Brief con opciones (unificado)</b>
            <small>Elige “Producto” primero: Web / App / Backend / Full-stack. Luego genera el prompt.</small>
          </div>
          <span class="tag"><span class="dot"></span>Sin backend</span>
        </div>

        <div class="body">
          <div class="row">
            <div>
              <label>Producto (tipo de solución)</label>
              <select id="productType">
                <option value="Web (página/sitio)">A) Web (página/sitio)</option>
                <option value="Web App (panel/sistema)">B) Web App (panel/sistema)</option>
                <option value="App móvil (iOS/Android)">C) App móvil (iOS/Android)</option>
                <option value="Backend / API">D) Backend / API</option>
                <option value="Full-stack (frontend + backend)">E) Full-stack (frontend + backend)</option>
                <option value="Herramienta interna (micro-app/script)">F) Herramienta interna (micro-app/script)</option>
              </select>
            </div>
            <div>
              <label>IA / plataforma destino (para pegar el prompt)</label>
              <select id="aiTarget">
                <option value="ChatGPT (general)">A) ChatGPT (general)</option>
                <option value="Claude (estructura + calidad)">B) Claude</option>
                <option value="Gemini (Google)">C) Gemini</option>
                <option value="Copilot (dev)">D) Copilot</option>
                <option value="Cualquier IA (agnóstico)">E) Cualquier IA (agnóstico)</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div>
              <label>Tipo de proyecto (web)</label>
              <select id="projectType">
                <option value="Landing page">A) Landing page (1 página, conversión)</option>
                <option value="Sitio web">B) Sitio web (3–8 páginas)</option>
                <option value="E-commerce">C) E-commerce (tienda)</option>
                <option value="Página informativa">D) Página informativa</option>
                <option value="Portfolio / Agencia">E) Portfolio / Agencia</option>
                <option value="Funnel / Página de ventas">F) Funnel / Página de ventas</option>
                <option value="Evento / Registro">G) Evento / Registro</option>
                <option value="Catálogo / Directorio">H) Catálogo / Directorio</option>
              </select>
            </div>
            <div>
              <label>Nicho / negocio</label>
              <select id="niche">
                <option value="Bufete de abogados">A) Abogados / legal</option>
                <option value="Restaurante">B) Restaurante</option>
                <option value="Agencia">C) Agencia</option>
                <option value="Salud">D) Salud</option>
                <option value="Educación">E) Educación</option>
                <option value="Tienda de productos">F) Tienda</option>
                <option value="Inmobiliaria">G) Inmobiliaria</option>
                <option value="Finanzas">H) Finanzas</option>
                <option value="Tecnología / IA">I) Tecnología / IA</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div>
              <label>Objetivo principal</label>
              <select id="goal">
                <option value="Captar leads">A) Captar leads</option>
                <option value="WhatsApp como canal principal">B) WhatsApp como canal principal</option>
                <option value="Agendar citas">C) Agendar citas</option>
                <option value="Vender">D) Vender</option>
                <option value="Branding / confianza">E) Branding / confianza</option>
                <option value="Soporte / tickets">F) Soporte / tickets</option>
                <option value="Registro / onboarding">G) Registro / onboarding</option>
              </select>
            </div>
            <div>
              <label>Nivel</label>
              <select id="level">
                <option value="Demo">A) Demo (mostrar rápido)</option>
                <option value="MVP">B) MVP (funcional)</option>
                <option value="Producción">C) Producción (cliente real)</option>
                <option value="Portafolio">D) Portafolio (caso de estudio)</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div>
              <label>Estilo visual</label>
              <select id="style">
                <option value="Corporate premium">A) Corporate premium</option>
                <option value="Tech futurista">B) Tech futurista</option>
                <option value="Minimalista limpio">C) Minimalista</option>
                <option value="Dark moderno">D) Dark moderno</option>
                <option value="Creativo atrevido">E) Creativo atrevido</option>
                <option value="Elegante editorial">F) Elegante editorial</option>
              </select>
            </div>
            <div>
              <label>Colores</label>
              <select id="colors">
                <option value="Elige tú según el estilo">A) Elige tú</option>
                <option value="Negro + blanco + dorado">B) Negro + blanco + dorado</option>
                <option value="Azul marino + blanco + dorado">C) Azul marino + blanco + dorado</option>
                <option value="Negro + neón (cian/morado)">D) Negro + neón (cian/morado)</option>
                <option value="Blanco + gris + acento">E) Blanco + gris + acento</option>
                <option value="Paleta exacta (yo la pondré)">F) Paleta exacta (yo la pondré)</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div>
              <label>Nombre de marca</label>
              <input id="brandName" placeholder="Ej: García y Asociados" />
            </div>
            <div>
              <label>Ciudad (opcional)</label>
              <input id="city" placeholder="Ej: Ciudad Juárez" />
            </div>
          </div>

          <div class="row">
            <div>
              <label>WhatsApp (formato internacional)</label>
              <input id="whatsapp" placeholder="Ej: 5216561234567" />
            </div>
            <div>
              <label>Tono del contenido</label>
              <select id="tone">
                <option value="Profesional y directo">A) Profesional y directo</option>
                <option value="Persuasivo vendedor">B) Persuasivo vendedor</option>
                <option value="Cercano humano">C) Cercano humano</option>
                <option value="Minimal y elegante">D) Minimal y elegante</option>
                <option value="Técnico experto">E) Técnico experto</option>
              </select>
            </div>
          </div>

          <div>
            <label>Servicios / features (separados por coma)</label>
            <input id="services" placeholder="Ej: Civil, Mercantil, Laboral / o: Login, Pagos, Agenda" />
          </div>

          <div style="height:12px"></div>

          <div class="row">
            <div>
              <label>Estilo de imágenes</label>
              <select id="imgStyle">
                <option value="Elige tú según el estilo">A) Elige tú</option>
                <option value="Fotografía realista">B) Fotografía realista</option>
                <option value="Ilustración premium">C) Ilustración premium</option>
                <option value="3D minimal">D) 3D minimal</option>
                <option value="Iconos + SVG local">E) Iconos + SVG local</option>
              </select>
            </div>
            <div>
              <label>Nivel de animación</label>
              <select id="animLevel">
                <option value="Sutil (reveal/hover)">A) Sutil (reveal/hover)</option>
                <option value="Moderada (parallax ligero)">B) Moderada (parallax ligero)</option>
                <option value="Llamativa (hero animado)">C) Llamativa (hero)</option>
                <option value="3D (si aplica)">D) 3D (si aplica)</option>
                <option value="Sin animaciones">E) Sin animaciones</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div>
              <label>SEO (por default recomendado)</label>
              <select id="seoLevel">
                <option value="SEO básico (title, description, OG, headings, alt)">A) SEO básico</option>
                <option value="SEO + Open Graph + Schema (JSON-LD)">B) SEO + Schema</option>
                <option value="SEO completo + sitemap/robots (si aplica)">C) SEO + sitemap/robots</option>
              </select>
            </div>
            <div>
              <label>Legal (footer)</label>
              <select id="legalPack">
                <option value="Privacidad + Términos + Cookies">A) Privacidad + Términos + Cookies</option>
                <option value="Privacidad + Términos">B) Privacidad + Términos</option>
                <option value="Solo Privacidad">C) Solo Privacidad</option>
              </select>
            </div>
          </div>

          <div style="height:12px"></div>

          <label>Módulos (para el código generado por la IA)</label>
          <div class="checks">
            <label class="ck"><input type="checkbox" id="m_whatsapp" checked />
              <div><b>WhatsApp flotante</b><small>Solo cambias el teléfono.</small></div>
            </label>
            <label class="ck"><input type="checkbox" id="m_form" checked />
              <div><b>Formulario validado</b><small>Sin backend; listo para EmailJS.</small></div>
            </label>
            <label class="ck"><input type="checkbox" id="m_booking" />
              <div><b>Agenda (demo local)</b><small>Guarda citas en el navegador.</small></div>
            </label>
            <label class="ck"><input type="checkbox" id="m_auth" />
              <div><b>Login/Auth</b><small>Base para app/webapp.</small></div>
            </label>
            <label class="ck"><input type="checkbox" id="m_anim" checked />
              <div><b>Animaciones</b><small>Scroll reveal ligero.</small></div>
            </label>
            <label class="ck"><input type="checkbox" id="m_music" />
              <div><b>Música ambiental</b><small>Web Audio (sin archivos).</small></div>
            </label>
            <label class="ck"><input type="checkbox" id="m_legal" checked />
              <div><b>Legal básico</b><small>Privacidad/Términos/Cookies.</small></div>
            </label>
            <label class="ck"><input type="checkbox" id="m_admin" />
              <div><b>Panel admin</b><small>CRUD simple para datos.</small></div>
            </label>
          </div>

          <div style="height:12px"></div>

          <label>Integraciones (listas para activar)</label>
          <div class="checks">
            <label class="ck"><input type="checkbox" id="i_emailjs" />
              <div><b>Email (EmailJS)</b><small>Form → correo sin backend.</small></div>
            </label>
            <label class="ck"><input type="checkbox" id="i_stripe" />
              <div><b>Pagos (Stripe)</b><small>Checkout/anticipo.</small></div>
            </label>
            <label class="ck"><input type="checkbox" id="i_paypal" />
              <div><b>Pagos (PayPal)</b><small>Botón/checkout.</small></div>
            </label>
            <label class="ck"><input type="checkbox" id="i_gcal" />
              <div><b>Google Calendar</b><small>Citas reales.</small></div>
            </label>
            <label class="ck"><input type="checkbox" id="i_supabase" />
              <div><b>BD (Supabase)</b><small>Usuarios/datos.</small></div>
            </label>
            <label class="ck"><input type="checkbox" id="i_firebase" />
              <div><b>Firebase</b><small>Auth/DB rápido.</small></div>
            </label>
            <label class="ck"><input type="checkbox" id="i_ga4" />
              <div><b>Analytics (GA4)</b><small>Eventos + conversiones.</small></div>
            </label>
            <label class="ck"><input type="checkbox" id="i_maps" />
              <div><b>Maps</b><small>Google Maps/Mapbox.</small></div>
            </label>
            <label class="ck"><input type="checkbox" id="i_recaptcha" />
              <div><b>reCAPTCHA</b><small>Anti-spam.</small></div>
            </label>
            <label class="ck"><input type="checkbox" id="i_onesignal" />
              <div><b>Notificaciones</b><small>OneSignal.</small></div>
            </label>
          </div>

          <div style="height:12px"></div>

          <!-- App/Backend specifics (mínimo) -->
          <div class="row">
            <div>
              <label>Stack preferido (si es App/WebApp)</label>
              <select id="appStack">
                <option value="Elige tú (recomendado)">A) Elige tú (recomendado)</option>
                <option value="React + Vite (webapp)">B) React + Vite (webapp)</option>
                <option value="Next.js (webapp + SEO)">C) Next.js</option>
                <option value="Flutter (móvil)">D) Flutter</option>
                <option value="React Native (móvil)">E) React Native</option>
              </select>
            </div>
            <div>
              <label>Backend preferido (si aplica)</label>
              <select id="backendStack">
                <option value="Elige tú (recomendado)">A) Elige tú (recomendado)</option>
                <option value="Node.js (Express)">B) Node.js (Express)</option>
                <option value="Node.js (NestJS)">C) Node.js (NestJS)</option>
                <option value="Python (FastAPI)">D) Python (FastAPI)</option>
                <option value="Firebase">E) Firebase</option>
                <option value="Supabase">F) Supabase</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div>
              <label>Autenticación (si aplica)</label>
              <select id="authMode">
                <option value="Sin login (demo)">A) Sin login (demo)</option>
                <option value="Email/Password">B) Email/Password</option>
                <option value="OAuth Google">C) OAuth Google</option>
                <option value="Magic Link">D) Magic Link</option>
              </select>
            </div>
            <div>
              <label>Datos principales (si backend/DB)</label>
              <input id="dataModel" placeholder="Ej: usuarios, citas, pagos, casos, productos" />
            </div>
          </div>

          <div style="height:14px"></div>

          <div class="actions">
            <button class="btn primary" id="btnGenerate">Generar Prompt</button>
            <button class="btn" id="btnCopyPrompt">Copiar PROMPT</button>
            <button class="btn" id="btnCopyBrief">Copiar BRIEF</button>
            <button class="btn" id="btnSavePreset">Guardar preset</button>
            <button class="btn" id="btnLoadPreset">Cargar preset</button>
            <button class="btn danger" id="btnReset">Reset</button>
          </div>

          <div style="height:10px"></div>
          <div class="hint">
            Nota: el prompt siempre exige <b>SWITCHBOARD</b> (ON/OFF) y comentarios <b>// EDITAR AQUÍ</b> para que no adivines nada.
          </div>
        </div>
      </div>

      <!-- RIGHT: OUTPUT -->
      <div class="card">
        <div class="head">
          <div>
            <b>Salida</b>
            <small>BRIEF + PROMPT MAESTRO listo para pegar. (El prompt se adapta si eliges App/Backend/Full-stack).</small>
          </div>
        </div>
        <div class="body">
          <label>BRIEF estructurado</label>
          <div class="out" id="outBrief">(Genera para ver contenido…)</div>

          <div style="height:12px"></div>

          <label>PROMPT MAESTRO listo</label>
          <div class="out" id="outPrompt">(Genera para ver contenido…)</div>

          <div style="height:12px"></div>

          <div class="hint">
            Flujo recomendado: Genera → copia prompt → pégalo en 2–3 IAs → eliges el mejor output → ya construyes.
          </div>
        </div>
      </div>
    </div>

    <footer class="container">
      <div class="footRow">
        <div>AI Code Sentinel · Prompt Factory v1.3 (personal)</div>
        <div style="display:flex; gap:14px; flex-wrap:wrap;">
          <a href="#" id="openPrivacy">Privacidad</a>
          <a href="#" id="openTerms">Términos</a>
          <a href="#" id="openCookies">Cookies</a>
        </div>
      </div>
    </footer>
  </div>

  <!-- Legal modal -->
  <div class="modalWrap" id="modalWrap" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modalHead">
        <b id="modalTitle">—</b>
        <button class="btn" id="modalClose">Cerrar</button>
      </div>
      <div class="modalBody" id="modalBody"></div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // === NO TOCAR (helpers) ===
    const $ = (id)=>document.getElementById(id);
    function toast(msg){
      const el = $("toast");
      el.textContent = msg;
      el.classList.add("on");
      clearTimeout(el._t);
      el._t = setTimeout(()=> el.classList.remove("on"), 1600);
    }
    function readChecks(ids){
      const obj = {};
      ids.forEach(id => obj[id] = !!$(id).checked);
      return obj;
    }
    async function copyText(text){
      try{ await navigator.clipboard.writeText(text); toast("Copiado ✅"); }
      catch(e){ toast("No se pudo copiar (copia manual)"); }
    }

    // === Legal modal content (base/demo) ===
    const PRIVACY_HTML = `
      <p><b>Última actualización:</b> ${new Date().toLocaleDateString("es-MX")}</p>
      <p>Este documento es base (demo) para proyectos. Para producción real, validar con un profesional.</p>
      <h3>Datos</h3>
      <ul><li>Contacto (nombre/teléfono/correo)</li><li>Preferencias (citas/servicios)</li></ul>
      <h3>Finalidad</h3>
      <ul><li>Responder solicitudes</li><li>Agendar citas</li><li>Mejorar el servicio</li></ul>
    `;
    const TERMS_HTML = `
      <p><b>Última actualización:</b> ${new Date().toLocaleDateString("es-MX")}</p>
      <p>Contenido informativo. La asesoría/servicio final depende de contrato, revisión y contexto.</p>
      <h3>Uso</h3>
      <ul><li>No usar para fines ilícitos</li><li>No suplantación</li></ul>
    `;
    const COOKIES_HTML = `
      <p><b>Última actualización:</b> ${new Date().toLocaleDateString("es-MX")}</p>
      <p>Este sitio puede usar cookies para analítica y experiencia. En demos, puede omitirse o simularse.</p>
    `;
    function openModal(title, html){
      $("modalTitle").textContent = title;
      $("modalBody").innerHTML = html;
      $("modalWrap").classList.add("on");
      $("modalWrap").setAttribute("aria-hidden","false");
    }
    function closeModal(){
      $("modalWrap").classList.remove("on");
      $("modalWrap").setAttribute("aria-hidden","true");
    }
    $("openPrivacy").addEventListener("click",(e)=>{e.preventDefault(); openModal("Aviso de privacidad", PRIVACY_HTML);});
    $("openTerms").addEventListener("click",(e)=>{e.preventDefault(); openModal("Términos y condiciones", TERMS_HTML);});
    $("openCookies").addEventListener("click",(e)=>{e.preventDefault(); openModal("Política de cookies", COOKIES_HTML);});
    $("modalClose").addEventListener("click", closeModal);
    $("modalWrap").addEventListener("click",(e)=>{ if(e.target.id==="modalWrap") closeModal(); });
    document.addEventListener("keydown",(e)=>{ if(e.key==="Escape") closeModal(); });

    // === PROMPT MAESTRO (motor fijo) ===
    function buildMasterPrompt(briefText){
      return `Actúa como arquitecto senior de productos digitales y desarrollador full-stack.

Debes generar proyectos reales (nivel agencia), no ejemplos.
Todo lo que entregues debe cumplir estas reglas:

REGLAS OBLIGATORIAS:
1) Código funcional en su versión base (sin backend si es demo, pero escalable).
2) Código comentado y estructurado.
3) Marcar SIEMPRE con comentarios:
   // EDITAR AQUÍ
   // MÓDULO OPCIONAL
   // ACTIVAR INTEGRACIÓN
   // NO TOCAR
4) Incluir un "SWITCHBOARD" al inicio para activar/desactivar módulos e integraciones (ON/OFF).
5) Incluir SEO por default (mínimo): title, meta description, Open Graph, headings correctos y alt en imágenes.
6) Incluir footer legal por default (según el pack): Privacidad / Términos / Cookies.
7) Explicar herramientas y pasos concretos para activar integraciones (EmailJS, Stripe, GA4, etc.).
8) Pensar el proyecto como escalable y vendible.

INPUT DEL PROYECTO (BRIEF):
${briefText}

OUTPUT OBLIGATORIO:
1) Arquitectura del proyecto (pantallas/secciones y flujo)
2) Stack recomendado (herramientas) + por qué
3) Wireflow (cómo navega el usuario)
4) Código completo funcional (si es web demo: en un solo index.html)
5) Switchboard de módulos (ON/OFF) + dónde pegar API keys
6) Lista exacta de lugares editables (teléfono, textos, imágenes, colores, links)
7) Guía de activación de integraciones (paso a paso)
8) Checklist de calidad (SEO básico, performance, accesibilidad)

No simplifiques.
No me des teoría.
Entrega ejecución clara, ordenada y profesional.`;
    }

    function buildBrief(){
      const productType = $("productType").value;
      const aiTarget = $("aiTarget").value;
      const projectType = $("projectType").value;
      const niche = $("niche").value;
      const goal = $("goal").value;
      const level = $("level").value;
      const style = $("style").value;
      const colors = $("colors").value;

      const brandName = $("brandName").value.trim() || "(Sin nombre — definir)";
      const city = $("city").value.trim() || "(No especificado)";
      const whatsapp = $("whatsapp").value.trim() || "521XXXXXXXXXX";
      const tone = $("tone").value;
      const services = $("services").value.trim() || "(No especificados)";

      const imgStyle = $("imgStyle").value;
      const animLevel = $("animLevel").value;
      const seoLevel = $("seoLevel").value;
      const legalPack = $("legalPack").value;

      const appStack = $("appStack").value;
      const backendStack = $("backendStack").value;
      const authMode = $("authMode").value;
      const dataModel = $("dataModel").value.trim() || "(No especificado)";

      const modules = readChecks(["m_whatsapp","m_form","m_booking","m_auth","m_anim","m_music","m_legal","m_admin"]);
      const integrations = readChecks(["i_emailjs","i_stripe","i_paypal","i_gcal","i_supabase","i_firebase","i_ga4","i_maps","i_recaptcha","i_onesignal"]);

      const moduleList = [
        modules.m_whatsapp ? "WhatsApp flotante" : null,
        modules.m_form ? "Formulario validado" : null,
        modules.m_booking ? "Agenda demo (localStorage)" : null,
        modules.m_auth ? "Login/Auth" : null,
        modules.m_admin ? "Panel admin / CRUD" : null,
        modules.m_anim ? "Animaciones (scroll reveal)" : null,
        modules.m_music ? "Música ambiental (Web Audio)" : null,
        modules.m_legal ? "Legal (footer + modales)" : null,
      ].filter(Boolean).join(", ") || "(ninguno)";

      const integList = [
        integrations.i_emailjs ? "EmailJS (form->email sin backend)" : null,
        integrations.i_stripe ? "Stripe (pagos/checkout)" : null,
        integrations.i_paypal ? "PayPal (pagos)" : null,
        integrations.i_gcal ? "Google Calendar (citas)" : null,
        integrations.i_supabase ? "Supabase (BD/usuarios)" : null,
        integrations.i_firebase ? "Firebase (auth/DB)" : null,
        integrations.i_ga4 ? "GA4 (analytics + eventos)" : null,
        integrations.i_maps ? "Maps (Google/Mapbox)" : null,
        integrations.i_recaptcha ? "reCAPTCHA (anti-spam)" : null,
        integrations.i_onesignal ? "OneSignal (push)" : null,
      ].filter(Boolean).join(", ") || "(ninguna)";

      // Ajustes según producto
      const productExtra = (()=>{
        if(productType.startsWith("App móvil")){
          return `=== APP MÓVIL (REQUISITOS) ===
Plataformas: iOS/Android
Stack preferido: ${appStack}
Autenticación: ${authMode}
Pantallas mínimas: onboarding, login (si aplica), home, detalle, perfil/ajustes
Requisito: navegación clara + estado + validaciones
Exportable: instrucciones para correr en local y build básico`;
        }
        if(productType.startsWith("Backend")){
          return `=== BACKEND / API (REQUISITOS) ===
Backend preferido: ${backendStack}
Modelo de datos: ${dataModel}
Endpoints mínimos: auth (si aplica), CRUD principal, healthcheck
Requisito: variables de entorno (.env), validación, manejo de errores
Incluye ejemplo de requests y estructura de carpetas`;
        }
        if(productType.startsWith("Full-stack")){
          return `=== FULL-STACK (REQUISITOS) ===
Frontend: ${appStack}
Backend: ${backendStack}
Auth: ${authMode}
Modelo de datos: ${dataModel}
Requisito: contrato API, seguridad básica, variables de entorno, despliegue sugerido`;
        }
        return `=== WEB (REQUISITOS) ===
Tipo de proyecto: ${projectType}
Requisito: responsive, performance básico, accesible, listo para publicar`;
      })();

      return `=== METADATA (USO PERSONAL) ===
IA destino: ${aiTarget}
Producto: ${productType}

=== CONTEXTO DEL PROYECTO ===
Marca: ${brandName}
Ciudad: ${city}
Nicho: ${niche}
Objetivo principal: ${goal}
Nivel: ${level}

=== IDENTIDAD VISUAL ===
Estilo visual: ${style}
Colores: ${colors}
Tono del contenido: ${tone}

=== IMÁGENES ===
Estilo de imágenes: ${imgStyle}
Requisito: usar imágenes locales/embebidas o placeholders; siempre con ALT.

=== ANIMACIONES ===
Nivel: ${animLevel}
Requisito: ligero, sin romper performance.

=== SEO ===
Nivel: ${seoLevel}
Requisito mínimo: title+description, OG tags, headings correctos, alt, favicon. (Schema si aplica.)

=== LEGAL / FOOTER ===
Pack: ${legalPack}
Requisito: footer con enlaces a Privacidad/Términos/Cookies en modales o secciones.

=== CONTENIDO / FEATURES ===
Servicios / features principales: ${services}
Requisito: generar copy en español listo para usar.

=== FUNCIONALIDADES (MÓDULOS) ===
Incluir: ${moduleList}

=== INTEGRACIONES (LISTAS PARA ACTIVAR) ===
Incluir: ${integList}

=== DATOS EDITABLES (OBLIGATORIO MARCAR EN CÓDIGO) ===
WhatsApp: ${whatsapp}

${productExtra}

=== REQUISITOS DE ENTREGA DEL CÓDIGO ===
- Incluir "SWITCHBOARD" al inicio para activar/desactivar módulos e integraciones.
- Marcar con comentarios:
  // EDITAR AQUÍ (teléfono, textos, colores, imágenes, links)
  // MÓDULO OPCIONAL (bloques)
  // ACTIVAR INTEGRACIÓN (dónde pegar API KEY / IDs)
  // NO TOCAR (lógica)
- Explicar herramientas y pasos concretos para activar cada integración seleccionada.
- Incluir instrucciones de publicación (GitHub Pages/Netlify) o ejecución (si app/backend).`;
    }

    function generate(){
      const brief = buildBrief();
      const prompt = buildMasterPrompt(brief);
      $("outBrief").textContent = brief;
      $("outPrompt").textContent = prompt;
      toast("Generado ✅");
    }

    // Presets (localStorage)
    const PRESET_KEY = "acs_prompt_factory_presets_v1";
    function loadPresets(){ try{ return JSON.parse(localStorage.getItem(PRESET_KEY)||"[]"); }catch(e){ return []; } }
    function savePresets(list){ localStorage.setItem(PRESET_KEY, JSON.stringify(list)); }

    function getState(){
      const ids = [
        "productType","aiTarget","projectType","niche","goal","level","style","colors",
        "brandName","city","whatsapp","tone","services","imgStyle","animLevel","seoLevel","legalPack",
        "appStack","backendStack","authMode","dataModel",
        "m_whatsapp","m_form","m_booking","m_auth","m_anim","m_music","m_legal","m_admin",
        "i_emailjs","i_stripe","i_paypal","i_gcal","i_supabase","i_firebase","i_ga4","i_maps","i_recaptcha","i_onesignal"
      ];
      const state = {};
      ids.forEach(id=>{
        const el = $(id);
        if(!el) return;
        state[id] = (el.type === "checkbox") ? el.checked : el.value;
      });
      return state;
    }

    function setState(state){
      Object.keys(state).forEach(id=>{
        const el = $(id);
        if(!el) return;
        if(el.type === "checkbox") el.checked = !!state[id];
        else el.value = state[id];
      });
      generate();
    }

    function savePreset(){
      const name = prompt("Nombre del preset (ej: Abogados Premium, Restaurante, App MVP):");
      if(!name) return;
      const presets = loadPresets();
      presets.unshift({ name, state: getState(), savedAt: Date.now() });
      savePresets(presets.slice(0,30));
      toast("Preset guardado ✅");
    }

    function loadPreset(){
      const presets = loadPresets();
      if(presets.length===0){ toast("No hay presets"); return; }
      const list = presets.map((p,i)=> `${i+1}) ${p.name}`).join("\n");
      const pick = prompt("Elige número:\n\n"+list);
      if(!pick) return;
      const idx = Number(pick)-1;
      if(!(idx>=0 && idx<presets.length)){ toast("Número inválido"); return; }
      setState(presets[idx].state);
      toast("Preset cargado ✅");
    }

    // Eventos
    $("btnGenerate").addEventListener("click", generate);
    $("btnCopyPrompt").addEventListener("click", ()=>{
      const t = $("outPrompt").textContent;
      if(!t || t.includes("(Genera")){ toast("Primero genera"); return; }
      copyText(t);
    });
    $("btnCopyBrief").addEventListener("click", ()=>{
      const t = $("outBrief").textContent;
      if(!t || t.includes("(Genera")){ toast("Primero genera"); return; }
      copyText(t);
    });
    $("btnSavePreset").addEventListener("click", savePreset);
    $("btnLoadPreset").addEventListener("click", loadPreset);

    $("btnReset").addEventListener("click", ()=>{
      // Defaults sanos
      $("productType").selectedIndex = 0;
      $("aiTarget").selectedIndex = 0;
      $("projectType").selectedIndex = 0;
      $("niche").selectedIndex = 0;
      $("goal").selectedIndex = 0;
      $("level").selectedIndex = 0;
      $("style").selectedIndex = 0;
      $("colors").selectedIndex = 0;
      $("tone").selectedIndex = 0;
      $("imgStyle").selectedIndex = 0;
      $("animLevel").selectedIndex = 0;
      $("seoLevel").selectedIndex = 1;   // SEO + Schema por default
      $("legalPack").selectedIndex = 0;

      $("appStack").selectedIndex = 0;
      $("backendStack").selectedIndex = 0;
      $("authMode").selectedIndex = 0;

      $("brandName").value = "";
      $("city").value = "";
      $("whatsapp").value = "";
      $("services").value = "";
      $("dataModel").value = "";

      $("m_whatsapp").checked = true;
      $("m_form").checked = true;
      $("m_booking").checked = false;
      $("m_auth").checked = false;
      $("m_anim").checked = true;
      $("m_music").checked = false;
      $("m_legal").checked = true;
      $("m_admin").checked = false;

      ["i_emailjs","i_stripe","i_paypal","i_gcal","i_supabase","i_firebase","i_ga4","i_maps","i_recaptcha","i_onesignal"]
        .forEach(id => $(id).checked = false);

      $("outBrief").textContent = "(Genera para ver contenido…)";
      $("outPrompt").textContent = "(Genera para ver contenido…)";
      toast("Reset ✅");
    });

    // Auto-fill ejemplo (para que siempre veas algo)
    window.addEventListener("load", ()=>{
      $("brandName").value = "García y Asociados";
      $("city").value = "Ciudad Juárez";
      $("services").value = "Civil, Mercantil, Laboral";
      $("seoLevel").value = "SEO + Open Graph + Schema (JSON-LD)";
      generate();
    });
  </script>
</body>
</html>
